<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Spyro 1 Reverse Engineering: Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Spyroscope.ico"/></td>
  <td id="projectalign">
   <div id="projectname">Spyro 1 Reverse Engineering
   </div>
   <div id="projectbrief">Decompilation of functions from Spyro 1 into human readable C</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Overview </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><span style="font-size:18px;"></span></p>
<p><span style="font-size:18px;"></span></p>
<h2><a class="anchor" id="autotoc_md0"></a>
Symbol Map</h2>
<p><span style="font-size:18px;"> <a href="symbol_map.html">Click here to see the symbols we have found</a></span></p>
<p><span style="font-size:18px;"></span></p>
<h2><a class="anchor" id="autotoc_md1"></a>
Overview</h2>
<p><span style="font-size:18px;"> At a high level, this is the way this reverse engineering project is set up currently:</span></p>
<p><span style="font-size:18px;">We are attempting to recompile assembly functions from spyro the dragon using C. The recompiled functions should be <b>functionally equivalent</b> and the <b>same amount or less</b> assembly opcodes. We are using a modern mips compiler. We are <b>not</b> aiming for byte for byte matches; instead <b>functionally equivalent matches</b> with an emphasis on <em>readability</em>, and ensuring the same or less amount of assembly opcodes from our compiled functions.</span></p>
<p><span style="font-size:18px;">We are currently placing our re-created functions in extra 8mb developer ram that <em>most ps1's do not have</em>, then replacing the first assembly instruction of the original function with a simple jump to our re-created function in the extra ram area. This current approach does not rebuild the game, but allows us to test our compiled code very easily. This is because everytime the game tries to run the original function, it simply jumps to our re-created version that is in the extra ram area instead.</span></p>
<p><span style="font-size:18px;">So long we aim for the same/less assembly opcodes, we should theoretically be able to place these recompiled functions into their correct spots eventually.</span></p>
<p><span style="font-size:18px;"></span></p>
<h2><a class="anchor" id="autotoc_md2"></a>
Recommended Tools:</h2>
<p><span style="font-size:18px;"></span></p>
<p><span style="font-size:18px;"></p><ol type="1">
<li>Ghidra: Very useful general reverse engineering/decompilation tool.</li>
<li>PCSX-Redux: Debugging emulator for easy testing of compiled code</li>
<li>spimdisasm: Command line utility for disassembling mips opcodes into a format decomp.me can understand</li>
</ol>
<p></span></p>
<p><span style="font-size:18px;"></span></p>
<h2><a class="anchor" id="autotoc_md3"></a>
Outline of our current workflow</h2>
<p><span style="font-size:18px;"></p><ol type="1">
<li>Copy decompiled function from Ghidra into new, or relavent .c file</li>
<li>Compare C code against assembly on decomp.me until same amount of instructions or less<ul>
<li>Can use "Copy Special... Byte String (No Spaces)" from Ghidra to get the asm opcodes, and then paste them into spimdisasm to disassemble the opcodes into the correct format for decomp.me</li>
</ul>
</li>
<li>Refactor to look more readable</li>
<li>Repeat 2 &amp; 3 until as readable as possible, while maintaining same amount of instructions or less.</li>
<li>Create .s file for replacing the original functions first instruction with a jump to our function</li>
<li>Associate address of original functions first instruction with our .s file in buildlist.txt using this format: NTSC, exe, 0x80xxxxxx, 0x0, asm/xxx.s</li>
<li>Create function prototype in relavent .h file</li>
<li>Document Function in .c file using this syntax: <div class="fragment"><div class="line">/**</div>
<div class="line"> * @brief Brief explaination of function</div>
<div class="line"> * @details More detailed explaination of function.</div>
<div class="line"> </div>
<div class="line"> * @param char* arg1 - first parameter</div>
<div class="line"> * @param int* arg2 - second parameter.</div>
<div class="line"> * @param int arg3 - third parameter.</div>
<div class="line"> * @return int ret - return value.</div>
<div class="line"> </div>
<div class="line"> * @note Function: FunctionName \n</div>
<div class="line"> * Original Address: 0x80xxxxxx \n</div>
<div class="line"> * Hook File: hool_file.s \n</div>
<div class="line"> * Prototype: header.h \n</div>
<div class="line"> * Prototype: header.h \n</div>
<div class="line"> * Amount of instructions: Same/Less/More/Untested (https://decomp.me/link) \n</div>
<div class="line">*/</div>
</div><!-- fragment --></li>
<li>Ensure function &amp; hook have been placed successfully by setting execution breakpoint on original function's address in redux.</li>
<li>Test your recreated function obvious issues in redux. </li>
</ol>
<p></span></p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
